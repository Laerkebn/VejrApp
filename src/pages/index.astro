---
import "../styles/global.css";
import Svg from "./svg.astro";
---



<html lang="da">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vejr App</title>
  </head>



  <body class="font-philosopher m-0 p-5 bg-gray-200 flex flex-col items-center">
   
    <div class="weather-search mb-5 flex gap-2.5 justify-center max-w-[600px] w-full">
      <input
        id="cityInput"
        type="text"
        placeholder="Søg efter by i Danmark..."
        class="flex-1 px-5 py-3 border-2 border-gray-500 rounded-lg text-base bg-white focus:outline-none focus:border-[#4e93a6]"
      />
      <button
        id="searchBtn"
        class="px-7 py-3 bg-[#4e93a6] text-white border-none font-bold rounded-lg hover:bg-[#3d7a89] cursor-pointer"
      >
        Søg
      </button>
    </div>

    <div id="weatherInfo" class="mb-5 text-center text-gray-800"></div>

    <div
      class="weather-container relative w-full max-w-[600px] aspect-[469.32/307.41] transition-colors duration-1000"
      style="background: var(--bg-color, #87CEEB)"
    >
      <!-- HER er mine SVG’er -->
      <Svg />
    </div>


    <script>
      // Tidsbaseret baggrund
      function updateBackgroundByTime() {
        const now = new Date();
        const hour = now.getHours() + now.getMinutes() / 60;

        const timeColors = [
          { hour: 0, color: [10, 20, 40] },
          { hour: 5, color: [25, 35, 60] },
          { hour: 6, color: [255, 140, 100] },
          { hour: 7, color: [109, 174, 207] },
          { hour: 8, color: [160, 210, 240] },
          { hour: 12, color: [135, 206, 235] },
          { hour: 16, color: [140, 200, 230] },
          { hour: 18, color: [255, 150, 100] },
          { hour: 19, color: [72, 82, 163] },
          { hour: 20, color: [80, 60, 100] },
          { hour: 21, color: [40, 40, 70] },
          { hour: 24, color: [10, 20, 40] },
        ];

        let before = timeColors[0];
        let after = timeColors[timeColors.length - 1];

        for (let i = 0; i < timeColors.length - 1; i++) {
          if (hour >= timeColors[i].hour && hour <= timeColors[i + 1].hour) {
            before = timeColors[i];
            after = timeColors[i + 1];
            break;
          }
        }

        const progress = (hour - before.hour) / (after.hour - before.hour);
        const r = Math.round(before.color[0] * (1 - progress) + after.color[0] * progress);
        const g = Math.round(before.color[1] * (1 - progress) + after.color[1] * progress);
        const b = Math.round(before.color[2] * (1 - progress) + after.color[2] * progress);

        document.documentElement.style.setProperty("--bg-color", `rgb(${r}, ${g}, ${b})`);
      }

      updateBackgroundByTime();
      setInterval(updateBackgroundByTime, 60 * 1000);

      // Vejr API funktion
      async function getWeather(city) {
        const API_KEY = "ea4457bca726d0664234f97788706bf3"; // <--- INDSÆT DIN API-NØGLE HER!
        const url = `https://api.openweathermap.org/data/2.5/weather?q=${city}&units=metric&lang=da&appid=${API_KEY}`;

        try {
          const res = await fetch(url);
          if (!res.ok) throw new Error("By ikke fundet");
          const data = await res.json();
          updateWeatherUI(data);
        } catch (err) {
          document.getElementById("weatherInfo").innerHTML =
            '<p class="text-red-600">Kunne ikke hente vejret. Tjek by-navn eller API-nøgle.</p>';
          console.error(err);
        }
      }

      function updateWeatherUI(data) {
        const condition = data.weather[0].main.toLowerCase();
        const temp = Math.round(data.main.temp);
        const description = data.weather[0].description;

        document.getElementById("weatherInfo").innerHTML =
          `<h3 class="text-2xl text-[#4e93a6] font-bold">${data.name} – ${temp}°C</h3>
           <p class="text-gray-600 mt-1">${description}</p>`;

        // Skjul alle vejr-lag først
        document.querySelectorAll(".weather-layer").forEach((el) => {
          el.classList.remove("visible");
        });

        // Vis relevante lag baseret på vejrforhold
        if (condition.includes("clear")) {
          document.getElementById("sol")?.classList.add("visible");
        }

        if (condition.includes("cloud")) {
          document.getElementById("lillessky")?.classList.add("visible");
          document.getElementById("graasky")?.classList.add("visible");
        }

        if (condition.includes("rain") || condition.includes("drizzle")) {
          document.getElementById("graasky")?.classList.add("visible");
          document.getElementById("storskygge")?.classList.add("visible");
          document.getElementById("layer-regn")?.classList.add("visible");
        }

        if (condition.includes("snow")) {
          document.getElementById("hvidsky")?.classList.add("visible");
          document.getElementById("layer-sne")?.classList.add("visible");
        }

        if (condition.includes("thunder")) {
          document.getElementById("graasky")?.classList.add("visible");
          document.getElementById("storskygge")?.classList.add("visible");
          document.getElementById("lyn")?.classList.add("visible");
        }

        // Tjek vindhastighed (over 10 m/s)
        if (data.wind && data.wind.speed > 10) {
          document.getElementById("vind")?.classList.add("visible");
        }
      }

      // Søgning ved klik
      document.getElementById("searchBtn")?.addEventListener("click", () => {
        const city = document.getElementById("cityInput").value.trim();
        if (city) {
          getWeather(city);
        } else {
          alert("Indtast venligst en by");
        }
      });

      // Søgning ved Enter-tast
      document.getElementById("cityInput")?.addEventListener("keypress", (e) => {
        if (e.key === "Enter") {
          const city = document.getElementById("cityInput").value.trim();
          if (city) {
            getWeather(city);
          }
        }
      });

      // Start med København som standardby
      getWeather("Copenhagen");
    </script>
    <style>
      .weather-layer {
        position: absolute;
        top: 0;
        left: 20%;
        width: 90%;
        height: 100%;
        transition: opacity 0.5s ease;
        opacity: 0;
        pointer-events: none;
      }

      .weather-layer.visible {
        opacity: 1;
        pointer-events: auto;
      }
    </style>
  </body>
</html>
